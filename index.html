<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Loan Model Simulator - Complete Financial Model</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --cream: #FFF8E7;
            --cream-dark: #F5E6C8;
            --black: #0A0A0A;
            --slate: #475569;
            --slate-light: #64748B;
            --slate-dark: #334155;
            --accent-green: #10B981;
            --accent-yellow: #F59E0B;
            --accent-red: #EF4444;
            --accent-blue: #3B82F6;
            --accent-purple: #8B5CF6;
            --accent-pink: #EC4899;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%);
            color: var(--black);
            line-height: 1.6;
            min-height: 100vh;
            padding: 1.5rem;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 1.5rem;
            animation: slideDown 0.6s ease-out;
        }
        
        h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.25rem;
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            font-size: 0.95rem;
            color: var(--slate);
            font-weight: 400;
        }
        
        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .mode-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: 2px solid var(--black);
            background: white;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-btn.active {
            background: var(--black);
            color: white;
        }
        
        .mode-btn:hover:not(.active) {
            background: var(--cream-dark);
        }
        
        .model-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .comparison-badge {
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .individual-model {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            border: 2px solid var(--accent-red);
        }
        
        .group-model {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border: 2px solid var(--accent-green);
        }
        
        .badge-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .badge-stats {
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05), 0 6px 12px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.6s ease-out;
            animation-fill-mode: both;
            border: 1px solid rgba(71, 85, 105, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .panel:nth-child(1) { animation-delay: 0.1s; }
        .panel:nth-child(2) { animation-delay: 0.2s; }
        .panel:nth-child(3) { animation-delay: 0.3s; }
        .panel:nth-child(4) { animation-delay: 0.4s; }
        .panel:nth-child(5) { animation-delay: 0.5s; }
        .panel:nth-child(6) { animation-delay: 0.6s; }
        
        .panel-header {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--black);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .panel-icon {
            font-size: 1.4rem;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .two-thirds {
            grid-column: span 2;
        }
        
        .control-group {
            margin-bottom: 1rem;
        }
        
        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--slate-dark);
            font-size: 0.85rem;
        }
        
        .control-value {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            color: var(--black);
            font-size: 0.95rem;
        }
        
        .slider, .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--cream-dark);
            border-radius: 8px;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            background: white;
            color: var(--black);
            transition: all 0.3s ease;
        }
        
        .slider:focus, .input-field:focus {
            outline: none;
            border-color: var(--black);
            box-shadow: 0 0 0 3px rgba(10, 10, 10, 0.1);
        }
        
        .slider:hover, .input-field:hover {
            border-color: var(--slate);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .metric-card {
            background: var(--cream);
            padding: 0.875rem;
            border-radius: 8px;
            border-left: 3px solid var(--black);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .metric-label {
            font-size: 0.75rem;
            color: var(--slate);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .metric-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--black);
        }
        
        .metric-subtext {
            font-size: 0.7rem;
            color: var(--slate-light);
            margin-top: 0.25rem;
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 1rem;
        }
        
        .flow-step {
            background: white;
            padding: 0.875rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--accent-blue);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .flow-step:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .flow-step-number {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--accent-blue);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .flow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
            margin-top: 0.5rem;
        }
        
        .flow-name {
            font-weight: 600;
            color: var(--black);
            font-size: 0.9rem;
        }
        
        .flow-amount {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: var(--accent-blue);
            font-size: 1rem;
        }
        
        .flow-details {
            font-size: 0.75rem;
            color: var(--slate);
            line-height: 1.4;
        }
        
        .income-stream {
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--accent-green);
            transition: all 0.3s ease;
        }
        
        .income-stream:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .income-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        
        .income-name {
            font-weight: 600;
            color: var(--black);
            font-size: 0.9rem;
        }
        
        .income-amount {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: var(--accent-green);
            font-size: 1rem;
        }
        
        .income-details {
            font-size: 0.75rem;
            color: var(--slate);
            line-height: 1.4;
        }
        
        .stakeholder-card {
            background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%);
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #6366F1;
            margin-bottom: 1rem;
        }
        
        .stakeholder-card.financier {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-color: var(--accent-yellow);
        }
        
        .stakeholder-card.imfuyo {
            background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%);
            border-color: var(--accent-purple);
        }
        
        .stakeholder-card.farmers {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border-color: var(--accent-green);
        }
        
        .stakeholder-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .roi-badge {
            display: inline-block;
            padding: 0.375rem 0.875rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            background: white;
            margin-left: auto;
        }
        
        .help-text {
            background: var(--slate-dark);
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            border-left: 4px solid #4F46E5;
        }
        
        .highlight-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: #312E81;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .highlight-text {
            font-size: 0.85rem;
            color: #4C1D95;
            line-height: 1.5;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--cream-dark);
            font-size: 0.85rem;
        }
        
        .comparison-table th {
            background: var(--cream);
            font-weight: 600;
            color: var(--black);
        }
        
        .comparison-table .better {
            color: var(--accent-green);
            font-weight: 600;
        }
        
        .comparison-table .worse {
            color: var(--accent-red);
            font-weight: 600;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 1400px) {
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .model-comparison {
                grid-template-columns: 1fr;
            }
            
            .mode-toggle {
                flex-direction: column;
            }
            
            h1 {
                font-size: 1.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üêê Group Loan Model Simulator</h1>
            <p class="subtitle">Complete Financial Breakdown: See How 300K Creates Value for Everyone</p>
        </header>
        
        <div class="mode-toggle">
            <button class="mode-btn active" onclick="switchMode('standard')">üìä Standard Model (300K Float)</button>
            <button class="mode-btn" onclick="switchMode('sandbox')">üéÆ Sandbox Mode (Custom Rates)</button>
        </div>
        
        <div class="model-comparison">
            <div class="comparison-badge individual-model">
                <div class="badge-title">‚ùå Individual Model</div>
                <div class="badge-stats">
                    Default Risk: <strong>10-15%</strong><br>
                    Monthly Burden: <strong>Kshs. 6,111</strong><br>
                    Income Streams: <strong>1 (Milk Only)</strong><br>
                    ROI for Financier: <strong>25-30%</strong>
                </div>
            </div>
            <div class="comparison-badge group-model">
                <div class="badge-title">‚úÖ Group Model (This Simulator)</div>
                <div class="badge-stats">
                    Default Risk: <strong>2-5%</strong><br>
                    Monthly Burden: <strong>Kshs. 1,200/person</strong><br>
                    Income Streams: <strong>4 (Diversified)</strong><br>
                    ROI for Financier: <strong id="headerROI">35-42%</strong>
                </div>
            </div>
        </div>
        
        <div class="dashboard">
            <!-- Panel 1: Float Breakdown - Step by Step -->
            <div class="panel full-width">
                <div class="panel-header">
                    <span class="panel-icon">üí∞</span>
                    Step-by-Step: How the 300K Float is Allocated
                </div>
                
                <div class="flow-step" style="border-left-color: var(--accent-purple);">
                    <div class="flow-step-number">1</div>
                    <div class="flow-header">
                        <span class="flow-name">üêê Breeding Buck Purchase</span>
                        <span class="flow-amount" id="buckPurchase">Kshs. 150,000</span>
                    </div>
                    <div class="flow-details">
                        High-quality breeding buck(s) - becomes group asset that generates breeding income
                    </div>
                </div>
                
                <div class="flow-step" style="border-left-color: var(--accent-blue);">
                    <div class="flow-step-number">2</div>
                    <div class="flow-header">
                        <span class="flow-name">üõ°Ô∏è Insurance, Logistics & Shed</span>
                        <span class="flow-amount" id="buckInsurance">Kshs. 50,000</span>
                    </div>
                    <div class="flow-details">
                        <span id="insuranceDetails">Insurance (20K) + Logistics (10K) + Shed (20K)</span>
                    </div>
                </div>
                
                <div class="flow-step" style="border-left-color: var(--accent-green);">
                    <div class="flow-step-number">3</div>
                    <div class="flow-header">
                        <span class="flow-name">üì¶ Remaining for Operations</span>
                        <span class="flow-amount" id="operationsTotal">Kshs. 100,000</span>
                    </div>
                    <div class="flow-details">
                        Allocated across: Feed, Training, Vet Services, and Agribusiness Education to boost milk production
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid var(--cream-dark);">
                    <h3 style="font-family: 'Space Grotesk'; font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--slate-dark);">
                        Operations Budget Breakdown (Kshs. <span id="opsBreakdownTotal">100,000</span>):
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                        <div class="metric-card" style="border-left-color: var(--accent-green);">
                            <div class="metric-label">üåæ Feed & Concentrate</div>
                            <div class="metric-value" style="font-size: 1.2rem;" id="feedAllocation">40,000</div>
                            <div class="metric-subtext">40% - Boosts milk 3x</div>
                        </div>
                        
                        <div class="metric-card" style="border-left-color: var(--accent-blue);">
                            <div class="metric-label">üéì Training Programs</div>
                            <div class="metric-value" style="font-size: 1.2rem;" id="trainingAllocation">25,000</div>
                            <div class="metric-subtext">25% - Billys + Imfuyo</div>
                        </div>
                        
                        <div class="metric-card" style="border-left-color: var(--accent-purple);">
                            <div class="metric-label">üíâ Vet Services</div>
                            <div class="metric-value" style="font-size: 1.2rem;" id="vetAllocation">20,000</div>
                            <div class="metric-subtext">20% - Health monitoring</div>
                        </div>
                        
                        <div class="metric-card" style="border-left-color: var(--accent-pink);">
                            <div class="metric-label">üìö Agribusiness Education</div>
                            <div class="metric-value" style="font-size: 1.2rem;" id="educationAllocation">15,000</div>
                            <div class="metric-subtext">15% - Business skills</div>
                        </div>
                    </div>
                    
                    <div class="metric-card" style="border-left-color: var(--black); background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); margin-top: 1rem;">
                        <div class="metric-label">‚úÖ Total Operations Allocated</div>
                        <div class="metric-value" style="font-size: 1.2rem; color: var(--accent-yellow);" id="totalAllocated">100,000</div>
                        <div class="metric-subtext">100% utilized for productivity</div>
                    </div>
                </div>
                
                <div class="highlight-box" style="background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%); border-left-color: var(--accent-green); margin-top: 1.5rem;">
                    <div class="highlight-title" style="color: #065F46;">üí° Smart Allocation Strategy</div>
                    <div class="highlight-text" style="color: #065F46;">
                        Every shilling is strategically invested: <strong>150K for the breeding buck</strong> (asset that generates ongoing income), <strong>50K for insurance, logistics & shed</strong> (protecting and housing the asset), and <strong>100K for operations</strong> (feed regiment, training, vet services, and business education) to maximize milk production from 0.5L to 1.5L per goat. This creates a self-sustaining ecosystem where farmers thrive and easily repay the loan.
                    </div>
                </div>
            </div>
            
            <!-- Sandbox Controls Panel (Hidden by default) -->
            <div class="panel full-width" id="sandboxControls" style="display: none;">
                <div class="panel-header">
                    <span class="panel-icon">üéÆ</span>
                    Sandbox Controls - Customize Your Model
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Total Float (Kshs.)</span>
                            <span class="control-value">Kshs. <span id="totalFloatValue">300,000</span></span>
                        </div>
                        <input type="number" min="200000" max="500000" step="10000" value="300000" class="input-field" id="totalFloat">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Group Members</span>
                            <span class="control-value"><span id="groupMembersValue">20</span> farmers</span>
                        </div>
                        <input type="number" min="10" max="50" step="1" value="20" class="input-field" id="groupMembers">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Goats per Farmer</span>
                            <span class="control-value"><span id="goatsPerFarmerValue">3</span> goats</span>
                        </div>
                        <input type="number" min="2" max="6" step="1" value="3" class="input-field" id="goatsPerFarmer">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Interest Rate (%/month)</span>
                            <span class="control-value"><span id="interestRateValue">3.0</span>%</span>
                        </div>
                        <input type="number" min="2" max="5" step="0.5" value="3" class="input-field" id="interestRate">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Milk Price (Kshs/L)</span>
                            <span class="control-value">Kshs. <span id="milkPriceValue">70</span></span>
                        </div>
                        <input type="number" min="50" max="100" step="5" value="70" class="input-field" id="milkPrice">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Target Milk (L/goat/day)</span>
                            <span class="control-value"><span id="targetMilkValue">1.5</span> L</span>
                        </div>
                        <input type="number" min="1" max="3" step="0.1" value="1.5" class="input-field" id="targetMilk">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Breeding Fee (Kshs)</span>
                            <span class="control-value">Kshs. <span id="breedingFeeValue">400</span></span>
                        </div>
                        <input type="number" min="200" max="600" step="50" value="400" class="input-field" id="breedingFee">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Imfuyo Fee (%)</span>
                            <span class="control-value"><span id="imfuyoFeeValue">10</span>%</span>
                        </div>
                        <input type="number" min="5" max="15" step="1" value="10" class="input-field" id="imfuyoFee">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Number of Bucks</span>
                            <span class="control-value"><span id="numBucksValue">1</span> buck(s)</span>
                        </div>
                        <input type="number" min="1" max="3" step="1" value="1" class="input-field" id="numBucks">
                    </div>
                </div>
            </div>
            
            <!-- Panel 2: Income Streams -->
            <div class="panel two-thirds">
                <div class="panel-header">
                    <span class="panel-icon">üíµ</span>
                    Group Income Streams (Monthly at Full Productivity)
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">ü•õ Milk Sales (Billys Offtaker)</span>
                        <span class="income-amount" id="milkIncome">Kshs. 126,000</span>
                    </div>
                    <div class="income-details">
                        <span id="milkDetails">60 goats √ó 1.5 L/day √ó 70 Kshs/L √ó 30 days = Primary revenue</span>
                    </div>
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">üêê Breeding Services</span>
                        <span class="income-amount" id="breedingIncome">Kshs. 8,000</span>
                    </div>
                    <div class="income-details">
                        <span id="breedingDetails">1 buck √ó 20 external farmers √ó 400 Kshs/service</span>
                    </div>
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">üå± Manure Sales</span>
                        <span class="income-amount" id="manureIncome">Kshs. 6,000</span>
                    </div>
                    <div class="income-details">
                        <span id="manureDetails">20 farmers √ó 10 Kshs/day √ó 30 days</span>
                    </div>
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">üë∂ Kid Sales (Monthly avg)</span>
                        <span class="income-amount" id="kidIncome">Kshs. 16,000</span>
                    </div>
                    <div class="income-details">
                        <span id="kidDetails">60 goats √ó 30% rate √ó 4,000 Kshs √∑ 3 months</span>
                    </div>
                </div>
                
                <div class="metrics-grid" style="margin-top: 1rem;">
                    <div class="metric-card" style="grid-column: 1 / -1; border-left-color: var(--accent-green);">
                        <div class="metric-label">Total Monthly Group Income</div>
                        <div class="metric-value" style="font-size: 2rem; color: var(--accent-green);" id="totalMonthlyIncome">156,000</div>
                        <div class="metric-subtext">4 diversified revenue streams</div>
                    </div>
                </div>
            </div>
            
            <!-- Panel 3: Group Metrics -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">üë•</span>
                    Group Configuration
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Total Farmers</div>
                        <div class="metric-value" id="displayGroupMembers">20</div>
                        <div class="metric-subtext">Community support</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Total Goats</div>
                        <div class="metric-value" id="totalGoats">60</div>
                        <div class="metric-subtext">Productive does</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Breeding Bucks</div>
                        <div class="metric-value" id="displayNumBucks">1</div>
                        <div class="metric-subtext">Group assets</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Target Milk/Goat</div>
                        <div class="metric-value" id="displayTargetMilk">1.5L</div>
                        <div class="metric-subtext">After feed program</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="milkGrowthChart"></canvas>
                </div>
            </div>
            
            <!-- Panel 4: The Three Winners - ROI Breakdown -->
            <div class="panel full-width">
                <div class="panel-header">
                    <span class="panel-icon">üèÜ</span>
                    The Three Winners: Who Makes What & ROI Analysis
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <!-- Financier -->
                    <div class="stakeholder-card financier">
                        <div class="stakeholder-title">
                            üè¶ Financier (Lender)
                            <span class="roi-badge" style="color: var(--accent-yellow);" id="financierROI">ROI: 38%</span>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #78350F; margin-bottom: 0.25rem;">Initial Investment:</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.5rem; font-weight: 700; color: #78350F;">
                                Kshs. <span id="financierInvestment">300,000</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #78350F; margin-bottom: 0.25rem;">Total Repayment (12 months):</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.3rem; font-weight: 700; color: #065F46;">
                                Kshs. <span id="financierRepayment">408,000</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #78350F; margin-bottom: 0.25rem;">Net Profit:</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.8rem; font-weight: 700; color: var(--accent-green);">
                                Kshs. <span id="financierProfit">108,000</span>
                            </div>
                        </div>
                        
                        <div style="font-size: 0.75rem; line-height: 1.4; color: #78350F;">
                            <strong>Monthly Payment:</strong> Kshs. <span id="financierMonthly">34,000</span><br>
                            <strong>Interest Rate:</strong> <span id="financierRate">3%/month</span><br>
                            <strong>Risk Level:</strong> <span style="color: var(--accent-green); font-weight: 600;">LOW (2-5% default)</span>
                        </div>
                    </div>
                    
                    <!-- Imfuyo -->
                    <div class="stakeholder-card imfuyo">
                        <div class="stakeholder-title">
                            üéØ Imfuyo (Facilitator)
                            <span class="roi-badge" style="color: var(--accent-purple);" id="imfuyoROI">Fee: 10%</span>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #4C1D95; margin-bottom: 0.25rem;">Service Fee on Repayment:</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.5rem; font-weight: 700; color: #4C1D95;">
                                <span id="imfuyoFeePercent">10</span>% of total
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #4C1D95; margin-bottom: 0.25rem;">Total Earnings (12 months):</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.8rem; font-weight: 700; color: var(--accent-green);">
                                Kshs. <span id="imfuyoEarnings">40,800</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #4C1D95; margin-bottom: 0.25rem;">Per Month Average:</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.3rem; font-weight: 700; color: #4C1D95;">
                                Kshs. <span id="imfuyoMonthly">3,400</span>
                            </div>
                        </div>
                        
                        <div style="font-size: 0.75rem; line-height: 1.4; color: #4C1D95;">
                            <strong>Services Provided:</strong><br>
                            ‚Ä¢ Farmer training & monitoring<br>
                            ‚Ä¢ Imfuyo platform tracking<br>
                            ‚Ä¢ Group coordination<br>
                            ‚Ä¢ Quality assurance
                        </div>
                    </div>
                    
                    <!-- Farmers -->
                    <div class="stakeholder-card farmers">
                        <div class="stakeholder-title">
                            üë®‚Äçüåæ Farmers (20 Members)
                            <span class="roi-badge" style="color: var(--accent-green);">Net: +450%</span>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #065F46; margin-bottom: 0.25rem;">Monthly Income per Farmer:</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.5rem; font-weight: 700; color: #065F46;">
                                Kshs. <span id="farmerMonthlyIncome">7,800</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #065F46; margin-bottom: 0.25rem;">Monthly Payment per Farmer:</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.2rem; font-weight: 700; color: #DC2626;">
                                - Kshs. <span id="farmerMonthlyPayment">1,700</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.75rem;">
                            <div style="font-size: 0.8rem; color: #065F46; margin-bottom: 0.25rem;">Net Monthly Take-Home:</div>
                            <div style="font-family: 'Space Grotesk'; font-size: 1.8rem; font-weight: 700; color: var(--accent-green);">
                                Kshs. <span id="farmerNetIncome">6,100</span>
                            </div>
                        </div>
                        
                        <div style="font-size: 0.75rem; line-height: 1.4; color: #065F46;">
                            <strong>Total Group Net (20 farmers):</strong> Kshs. <span id="totalFarmersNet">122,000</span>/month<br>
                            <strong>Payment Burden:</strong> <span id="paymentBurden">22%</span> of income<br>
                            <strong>Keep:</strong> <span style="font-size: 1rem; font-weight: 700;" id="keepPercentage">78%</span> of earnings
                        </div>
                    </div>
                </div>
                
                <div class="highlight-box" style="margin-top: 1.5rem; background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-left-color: var(--accent-yellow);">
                    <div class="highlight-title" style="color: #78350F;">üéØ Why Everyone Wins</div>
                    <div class="highlight-text" style="color: #78350F;">
                        <strong>Financier:</strong> Gets <span id="summaryFinancierROI">38%</span> ROI (vs 25-30% individual model) with lower risk<br>
                        <strong>Imfuyo:</strong> Earns Kshs. <span id="summaryImfuyoTotal">40,800</span> over 12 months for facilitation services<br>
                        <strong>Farmers:</strong> Each keeps Kshs. <span id="summaryFarmerNet">6,100</span>/month after paying only Kshs. <span id="summaryFarmerPayment">1,700</span> (vs 6,111 individual)<br>
                        <br>
                        <strong>Total value created:</strong> Kshs. <span id="totalValueCreated">1,872,000</span> in group income over 12 months!
                    </div>
                </div>
            </div>
            
            <!-- Panel 5: 12-Month Financial Projection -->
            <div class="panel full-width">
                <div class="panel-header">
                    <span class="panel-icon">üìä</span>
                    12-Month Financial Projection & Cash Flow
                </div>
                
                <div class="chart-container" style="height: 300px;">
                    <canvas id="projectionChart"></canvas>
                </div>
                
                <div class="metrics-grid" style="grid-template-columns: repeat(4, 1fr); margin-top: 1.5rem;">
                    <div class="metric-card" style="border-left-color: var(--accent-green);">
                        <div class="metric-label">Total Group Income (12mo)</div>
                        <div class="metric-value" style="font-size: 1.2rem;" id="total12MonthIncome">1,872,000</div>
                        <div class="metric-subtext">All revenue streams</div>
                    </div>
                    
                    <div class="metric-card" style="border-left-color: var(--accent-red);">
                        <div class="metric-label">Total Repayment (12mo)</div>
                        <div class="metric-value" style="font-size: 1.2rem;" id="total12MonthRepay">408,000</div>
                        <div class="metric-subtext">Principal + interest</div>
                    </div>
                    
                    <div class="metric-card" style="border-left-color: var(--accent-blue);">
                        <div class="metric-label">Group Net Profit (12mo)</div>
                        <div class="metric-value" style="font-size: 1.2rem;" id="total12MonthProfit">1,464,000</div>
                        <div class="metric-subtext">After loan payment</div>
                    </div>
                    
                    <div class="metric-card" style="border-left-color: var(--accent-purple);">
                        <div class="metric-label">Average Monthly Surplus</div>
                        <div class="metric-value" style="font-size: 1.2rem;" id="avgMonthlySurplus">122,000</div>
                        <div class="metric-subtext">Distributed to farmers</div>
                    </div>
                </div>
            </div>
            
            <!-- Panel 5.5: Beyond the First 12 Months - The Real ROI Growth -->
            <div class="panel full-width">
                <div class="panel-header">
                    <span class="panel-icon">üöÄ</span>
                    Beyond Month 12: This is Just the Beginning - The Real ROI Growth
                </div>
                
                <div class="highlight-box" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-left-color: var(--accent-yellow); margin-top: 0;">
                    <div class="highlight-title" style="color: #78350F;">üéØ The Pilot is the Foundation, Not the Ceiling</div>
                    <div class="highlight-text" style="color: #78350F;">
                        The <strong id="month12ROI">38%</strong> ROI in year one is just the <strong>pilot phase</strong>. Once the group completes their first loan cycle, they become a <strong>proven, creditworthy customer base</strong> with verified income, payment history, and production data. This unlocks exponential growth opportunities for the financier.
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-top: 1.5rem;">
                    <!-- Column 1: Individual Product Expansion -->
                    <div>
                        <h3 style="font-family: 'Space Grotesk'; font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem; color: var(--black);">
                            üìà Individual Product Expansion
                        </h3>
                        
                        <div class="flow-step" style="border-left-color: var(--accent-blue); margin-bottom: 1rem;">
                            <div class="flow-step-number">1</div>
                            <div class="flow-header">
                                <span class="flow-name">üåæ Feed Inventory Loans</span>
                                <span class="flow-amount">Kshs. 10-20K/farmer</span>
                            </div>
                            <div class="flow-details">
                                Farmers now have proven income streams. Offer individual working capital loans for bulk feed purchases at better rates. <strong>ROI: 30-35%</strong> with near-zero default risk (you have their milk payment data).
                            </div>
                        </div>
                        
                        <div class="flow-step" style="border-left-color: var(--accent-purple); margin-bottom: 1rem;">
                            <div class="flow-step-number">2</div>
                            <div class="flow-header">
                                <span class="flow-name">‚ùÑÔ∏è Chiller/Storage Equipment</span>
                                <span class="flow-amount">Kshs. 30-50K/farmer</span>
                            </div>
                            <div class="flow-details">
                                Help farmers store milk longer, reduce spoilage, negotiate better prices. Loan for personal chillers backed by their established revenue. <strong>ROI: 35-40%</strong> + reduces your offtake risk.
                            </div>
                        </div>
                        
                        <div class="flow-step" style="border-left-color: var(--accent-green); margin-bottom: 1rem;">
                            <div class="flow-step-number">3</div>
                            <div class="flow-header">
                                <span class="flow-name">üêê Herd Expansion Loans</span>
                                <span class="flow-amount">Kshs. 40-80K/farmer</span>
                            </div>
                            <div class="flow-details">
                                Farmers want to grow from 3 goats to 5-8 goats. You finance the additional livestock. More goats = more milk = more revenue for everyone. <strong>ROI: 32-38%</strong> with livestock as collateral.
                            </div>
                        </div>
                        
                        <div class="flow-step" style="border-left-color: var(--accent-pink); margin-bottom: 1rem;">
                            <div class="flow-step-number">4</div>
                            <div class="flow-header">
                                <span class="flow-name">üè† Infrastructure Upgrades</span>
                                <span class="flow-amount">Kshs. 20-40K/farmer</span>
                            </div>
                            <div class="flow-details">
                                Better shelters, water systems, fencing. Improves animal health and productivity. Backed by Imfuyo data showing their payment discipline. <strong>ROI: 28-33%</strong>.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Column 2: Data-Driven Innovation -->
                    <div>
                        <h3 style="font-family: 'Space Grotesk'; font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem; color: var(--black);">
                            üí° Data-Driven Innovation & Scale
                        </h3>
                        
                        <div class="income-stream" style="border-left-color: var(--accent-blue); margin-bottom: 1rem;">
                            <div class="income-header">
                                <span class="income-name">üìä Imfuyo Data Intelligence</span>
                            </div>
                            <div class="income-details">
                                Every farmer tracked: milk output, payment history, feed conversion rates, breeding success. This data lets you create <strong>predictive risk models</strong>, personalize loan terms, and identify top performers for premium products. You're building a <strong>proprietary credit scoring system</strong> for smallholder farmers.
                            </div>
                        </div>
                        
                        <div class="income-stream" style="border-left-color: var(--accent-purple); margin-bottom: 1rem;">
                            <div class="income-header">
                                <span class="income-name">üîÑ Repeat Group Cycles</span>
                            </div>
                            <div class="income-details">
                                Same group takes a <strong>larger loan</strong> (400-500K) for year 2 with better terms. Lower risk, higher volume = better margins. Or replicate the model with <strong>10 new groups</strong> using learnings from the pilot. <strong>Scale to 200-500 farmers in year 2</strong>.
                            </div>
                        </div>
                        
                        <div class="income-stream" style="border-left-color: var(--accent-green); margin-bottom: 1rem;">
                            <div class="income-header">
                                <span class="income-name">üéØ Cross-Sell Financial Products</span>
                            </div>
                            <div class="income-details">
                                Insurance products, savings accounts, school fee loans, emergency credit. You have 20 farmers with <strong>proven income</strong> who trust you. Cross-selling to this base = <strong>20-30% additional revenue per customer</strong> with minimal acquisition cost.
                            </div>
                        </div>
                        
                        <div class="income-stream" style="border-left-color: var(--accent-yellow); margin-bottom: 1rem;">
                            <div class="income-header">
                                <span class="income-name">üåç Value Chain Integration</span>
                            </div>
                            <div class="income-details">
                                Partner with Billys or other offtakers for <strong>supply chain financing</strong>. Finance their procurement directly. Or work backward: finance feed suppliers, vet services, equipment vendors. Every node in the value chain becomes a revenue opportunity. <strong>Ecosystem ROI: 40-50%+</strong>.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem;">
                    <div class="metric-card" style="border-left-color: var(--accent-green); background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);">
                        <div class="metric-label">Year 2 Potential Revenue</div>
                        <div class="metric-value" style="font-size: 1.3rem; color: #065F46;" id="year2Revenue">2.5M - 4M</div>
                        <div class="metric-subtext">From same 20 farmers + new groups</div>
                    </div>
                    
                    <div class="metric-card" style="border-left-color: var(--accent-blue); background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);">
                        <div class="metric-label">3-Year Portfolio Value</div>
                        <div class="metric-value" style="font-size: 1.3rem; color: #1E40AF;">8M - 15M</div>
                        <div class="metric-subtext">With 100-200 farmer network</div>
                    </div>
                    
                    <div class="metric-card" style="border-left-color: var(--accent-purple); background: linear-gradient(135deg, #EDE9FE 0%, #DDD6FE 100%);">
                        <div class="metric-label">Data Asset Value</div>
                        <div class="metric-value" style="font-size: 1.3rem; color: #6B21A8;">Priceless</div>
                        <div class="metric-subtext">Proprietary farmer credit database</div>
                    </div>
                </div>
                
                <div class="highlight-box" style="margin-top: 1.5rem;">
                    <div class="highlight-title">üöÄ The Compounding Effect</div>
                    <div class="highlight-text">
                        <strong>Month 12:</strong> You've made <strong><span id="summaryYear1Profit">108,000</span> Kshs profit</strong> (38% ROI) and have 20 farmers with perfect payment history.<br><br>
                        
                        <strong>Year 2:</strong> Those same 20 farmers take individual loans totaling <strong>1.2M Kshs</strong> (60K average each for feed, equipment, expansion). You add 3 more groups (60 farmers). Total portfolio: <strong>2.4M</strong>. Profit: <strong>800K-1M</strong>.<br><br>
                        
                        <strong>Year 3:</strong> 200+ farmers, <strong>8M portfolio</strong>. You're the dominant agricultural lender in the region with <strong>zero marketing cost</strong> (word of mouth + Imfuyo data). Profit: <strong>2.5-3.5M</strong>. ROI on initial 300K: <strong>1,000%+ cumulative</strong>.<br><br>
                        
                        <strong>The kicker?</strong> Every loan is backed by real-time production data, verified income streams, and social collateral. Default rates stay below 3%. You're not just a financier ‚Äî you're building <strong>the agricultural finance infrastructure</strong> for your region.
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem; border: 2px solid var(--accent-yellow);">
                    <div style="font-family: 'Space Grotesk'; font-size: 1.2rem; font-weight: 700; color: #78350F; margin-bottom: 0.75rem; text-align: center;">
                        üíé This Pilot is Your Market Entry ‚Äî The Data is Your Moat
                    </div>
                    <div style="font-size: 0.9rem; color: #78350F; line-height: 1.6; text-align: center;">
                        Other lenders see farmers as risky. You have <strong>Imfuyo tracking</strong> proving they're not. Every farmer you finance becomes a <strong>verified, scored, data-backed customer</strong>. That's an unfair advantage. The 38% ROI in year one is just the price of admission to a <strong>10-year, multi-million shilling opportunity</strong>.
                    </div>
                </div>
            </div>
            
            <!-- Panel 6: Comparison Table -->
            <div class="panel full-width">
                <div class="panel-header">
                    <span class="panel-icon">‚öñÔ∏è</span>
                    Group Model vs Individual Model: Side-by-Side Comparison
                </div>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Individual Model</th>
                            <th>Group Model</th>
                            <th>Difference</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Default Risk</strong></td>
                            <td class="worse">10-15%</td>
                            <td class="better">2-5%</td>
                            <td class="better">‚Üì 67% lower risk</td>
                        </tr>
                        <tr>
                            <td><strong>Monthly Payment/Farmer</strong></td>
                            <td class="worse">Kshs. 6,111</td>
                            <td class="better">Kshs. <span id="compPayment">1,700</span></td>
                            <td class="better">‚Üì <span id="compPaymentDiff">72%</span> lighter</td>
                        </tr>
                        <tr>
                            <td><strong>Income Streams</strong></td>
                            <td class="worse">1 (Milk only)</td>
                            <td class="better">4 (Diversified)</td>
                            <td class="better">+300% more streams</td>
                        </tr>
                        <tr>
                            <td><strong>Financier ROI (12 months)</strong></td>
                            <td>25-30%</td>
                            <td class="better"><span id="compFinancierROI">38%</span></td>
                            <td class="better">+<span id="compFinancierDiff">27%</span> higher</td>
                        </tr>
                        <tr>
                            <td><strong>Community Support</strong></td>
                            <td class="worse">None (isolated)</td>
                            <td class="better">High (peer accountability)</td>
                            <td class="better">Social collateral</td>
                        </tr>
                        <tr>
                            <td><strong>Asset Ownership</strong></td>
                            <td class="worse">Individual debt burden</td>
                            <td class="better">Shared group assets</td>
                            <td class="better">Distributed risk</td>
                        </tr>
                        <tr>
                            <td><strong>Farmer Monthly Net Income</strong></td>
                            <td class="worse">~Kshs. 4,000</td>
                            <td class="better">Kshs. <span id="compFarmerNet">6,100</span></td>
                            <td class="better">+<span id="compFarmerDiff">53%</span> more income</td>
                        </tr>
                        <tr>
                            <td><strong>Training & Support</strong></td>
                            <td class="worse">Minimal</td>
                            <td class="better">Comprehensive (Billys + Imfuyo)</td>
                            <td class="better">Ongoing capacity building</td>
                        </tr>
                        <tr>
                            <td><strong>Monitoring & Data</strong></td>
                            <td class="worse">Limited/manual</td>
                            <td class="better">Real-time (Imfuyo platform)</td>
                            <td class="better">100% transparency</td>
                        </tr>
                        <tr style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);">
                            <td><strong>Future Growth Potential</strong></td>
                            <td class="worse">Limited repeat business</td>
                            <td class="better">Exponential (individual loans, new groups, data products)</td>
                            <td class="better">10-year portfolio opportunity</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="highlight-box" style="margin-top: 1.5rem;">
                    <div class="highlight-title">üéØ The Bottom Line</div>
                    <div class="highlight-text">
                        The group model is <strong>objectively superior</strong> across every metric. Financiers earn more with less risk in year one, and unlock a <strong>10-year growth runway</strong> with proven customers, proprietary data, and product expansion opportunities. Imfuyo builds sustainable facilitation revenue and becomes the trusted data layer. Farmers pay less, earn more, and gain community support. This is a true win-win-win model that transforms individual struggle into collective prosperity ‚Äî and the 38% year-one ROI is just the beginning.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global state
        let state = {
            mode: 'standard',
            totalFloat: 300000,
            groupMembers: 20,
            goatsPerFarmer: 3,
            numBucks: 1,
            targetMilk: 1.5,
            interestRate: 3.0,
            milkPrice: 70,
            breedingFee: 400,
            imfuyoFee: 10
        };
        
        // Constants
        const BUCK_PRICE = 150000;
        const BUCK_INSURANCE_LOGISTICS_SHED = 50000;
        const MANURE_PER_DAY = 10;
        const KID_PRICE = 4000;
        const BREEDING_RATE = 0.3;
        const EXTERNAL_FARMERS_PER_BUCK = 20;
        const TENURE_MONTHS = 12;
        
        // Chart instances
        let milkGrowthChart, projectionChart;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            attachEventListeners();
            updateAll();
        });
        
        function switchMode(mode) {
            state.mode = mode;
            
            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide sandbox controls
            if (mode === 'sandbox') {
                document.getElementById('sandboxControls').style.display = 'flex';
            } else {
                document.getElementById('sandboxControls').style.display = 'none';
                // Reset to standard values
                state.totalFloat = 300000;
                state.groupMembers = 20;
                state.goatsPerFarmer = 3;
                state.numBucks = 1;
                state.targetMilk = 1.5;
                state.interestRate = 3.0;
                state.milkPrice = 70;
                state.breedingFee = 400;
                state.imfuyoFee = 10;
                updateAll();
            }
        }
        
        function initializeCharts() {
            // Milk Growth Chart
            const milkCtx = document.getElementById('milkGrowthChart').getContext('2d');
            milkGrowthChart = new Chart(milkCtx, {
                type: 'line',
                data: {
                    labels: ['Month 0', 'Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5', 'Month 6'],
                    datasets: [{
                        label: 'Liters/Goat/Day',
                        data: [0.5, 0.7, 1.0, 1.2, 1.4, 1.5, 1.5],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Milk: ' + context.parsed.y + ' L/goat/day';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 2,
                            ticks: {
                                callback: function(value) {
                                    return value + ' L';
                                }
                            }
                        }
                    }
                }
            });
            
            // Projection Chart
            const projCtx = document.getElementById('projectionChart').getContext('2d');
            projectionChart = new Chart(projCtx, {
                type: 'bar',
                data: {
                    labels: ['M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9', 'M10', 'M11', 'M12'],
                    datasets: [
                        {
                            label: 'Group Income',
                            data: [],
                            backgroundColor: '#10B981',
                            borderRadius: 6
                        },
                        {
                            label: 'Loan Payment',
                            data: [],
                            backgroundColor: '#EF4444',
                            borderRadius: 6
                        },
                        {
                            label: 'Net to Farmers',
                            data: [],
                            backgroundColor: '#3B82F6',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: false },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Kshs. ' + (value / 1000) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: 'DM Sans', size: 11 },
                                padding: 10
                            }
                        }
                    }
                }
            });
        }
        
        function attachEventListeners() {
            // Sandbox controls
            const controls = [
                'totalFloat', 'groupMembers', 'goatsPerFarmer', 'numBucks',
                'targetMilk', 'interestRate', 'milkPrice', 'breedingFee', 'imfuyoFee'
            ];
            
            controls.forEach(control => {
                const element = document.getElementById(control);
                if (element) {
                    element.addEventListener('input', (e) => {
                        state[control] = control === 'targetMilk' || control === 'interestRate' 
                            ? parseFloat(e.target.value) 
                            : parseInt(e.target.value);
                        updateAll();
                    });
                }
            });
        }
        
        function calculateFinancials() {
            // Basic calculations
            const totalGoats = state.groupMembers * state.goatsPerFarmer;
            const buckCost = BUCK_PRICE * state.numBucks;
            const buckInsuranceLogisticsShed = BUCK_INSURANCE_LOGISTICS_SHED;
            const operationsTotal = state.totalFloat - buckCost - buckInsuranceLogisticsShed;
            
            // Operations breakdown (percentages)
            const feedAllocation = operationsTotal * 0.40;  // 40% for feed & concentrate
            const trainingAllocation = operationsTotal * 0.25;  // 25% for training
            const vetAllocation = operationsTotal * 0.20;  // 20% for vet services
            const educationAllocation = operationsTotal * 0.15;  // 15% for agribusiness education
            
            // Income streams
            const milkIncome = totalGoats * state.targetMilk * state.milkPrice * 30;
            const breedingIncome = state.numBucks * EXTERNAL_FARMERS_PER_BUCK * state.breedingFee;
            const manureIncome = state.groupMembers * MANURE_PER_DAY * 30;
            const kidIncome = (totalGoats * BREEDING_RATE * KID_PRICE) / 3;
            const totalMonthlyIncome = milkIncome + breedingIncome + manureIncome + kidIncome;
            
            // Loan calculations
            const monthlyInterest = state.totalFloat * (state.interestRate / 100);
            const totalInterest = monthlyInterest * TENURE_MONTHS;
            const totalRepayable = state.totalFloat + totalInterest;
            const monthlyRepayment = totalRepayable / TENURE_MONTHS;
            
            // Imfuyo fee (on total repayment)
            const imfuyoTotalEarnings = totalRepayable * (state.imfuyoFee / 100);
            const imfuyoMonthlyEarnings = imfuyoTotalEarnings / TENURE_MONTHS;
            
            // Actual payment from farmers (repayment + Imfuyo fee)
            const totalMonthlyPayment = monthlyRepayment + imfuyoMonthlyEarnings;
            const perFarmerPayment = totalMonthlyPayment / state.groupMembers;
            
            // Financier calculations
            const financierProfit = totalInterest;
            const financierROI = (financierProfit / state.totalFloat) * 100;
            
            // Farmer calculations
            const farmerMonthlyIncome = totalMonthlyIncome / state.groupMembers;
            const farmerNetIncome = farmerMonthlyIncome - perFarmerPayment;
            const paymentBurdenPercent = (perFarmerPayment / farmerMonthlyIncome) * 100;
            
            // 12-month totals
            const total12MonthIncome = totalMonthlyIncome * TENURE_MONTHS;
            const total12MonthRepay = totalRepayable;
            const total12MonthProfit = total12MonthIncome - total12MonthRepay - imfuyoTotalEarnings;
            const avgMonthlySurplus = total12MonthProfit / TENURE_MONTHS;
            
            return {
                totalGoats,
                buckCost,
                buckInsuranceLogisticsShed,
                operationsTotal,
                feedAllocation,
                trainingAllocation,
                vetAllocation,
                educationAllocation,
                milkIncome,
                breedingIncome,
                manureIncome,
                kidIncome,
                totalMonthlyIncome,
                monthlyRepayment,
                totalRepayable,
                perFarmerPayment,
                imfuyoTotalEarnings,
                imfuyoMonthlyEarnings,
                financierProfit,
                financierROI,
                farmerMonthlyIncome,
                farmerNetIncome,
                paymentBurdenPercent,
                total12MonthIncome,
                total12MonthRepay,
                total12MonthProfit,
                avgMonthlySurplus,
                totalMonthlyPayment
            };
        }
        
        function updateAll() {
            const fin = calculateFinancials();
            
            // Update sandbox value displays
            if (state.mode === 'sandbox') {
                document.getElementById('totalFloatValue').textContent = state.totalFloat.toLocaleString();
                document.getElementById('groupMembersValue').textContent = state.groupMembers;
                document.getElementById('goatsPerFarmerValue').textContent = state.goatsPerFarmer;
                document.getElementById('interestRateValue').textContent = state.interestRate.toFixed(1);
                document.getElementById('milkPriceValue').textContent = state.milkPrice;
                document.getElementById('targetMilkValue').textContent = state.targetMilk.toFixed(1);
                document.getElementById('breedingFeeValue').textContent = state.breedingFee;
                document.getElementById('imfuyoFeeValue').textContent = state.imfuyoFee;
                document.getElementById('numBucksValue').textContent = state.numBucks;
            }
            
            // Update header ROI
            document.getElementById('headerROI').textContent = fin.financierROI.toFixed(0) + '%';
            
            // Update float breakdown
            document.getElementById('buckPurchase').textContent = 'Kshs. ' + fin.buckCost.toLocaleString();
            document.getElementById('buckInsurance').textContent = 'Kshs. ' + fin.buckInsuranceLogisticsShed.toLocaleString();
            document.getElementById('operationsTotal').textContent = 'Kshs. ' + Math.round(fin.operationsTotal).toLocaleString();
            document.getElementById('opsBreakdownTotal').textContent = Math.round(fin.operationsTotal).toLocaleString();
            
            document.getElementById('feedAllocation').textContent = Math.round(fin.feedAllocation).toLocaleString();
            document.getElementById('trainingAllocation').textContent = Math.round(fin.trainingAllocation).toLocaleString();
            document.getElementById('vetAllocation').textContent = Math.round(fin.vetAllocation).toLocaleString();
            document.getElementById('educationAllocation').textContent = Math.round(fin.educationAllocation).toLocaleString();
            document.getElementById('totalAllocated').textContent = Math.round(fin.operationsTotal).toLocaleString();
            
            // Update insurance details
            document.getElementById('insuranceDetails').textContent = 
                `Insurance (${Math.round(fin.buckInsuranceLogisticsShed * 0.40).toLocaleString()}) + Logistics (${Math.round(fin.buckInsuranceLogisticsShed * 0.20).toLocaleString()}) + Shed (${Math.round(fin.buckInsuranceLogisticsShed * 0.40).toLocaleString()})`;
            
            // Update income streams
            document.getElementById('milkIncome').textContent = 'Kshs. ' + Math.round(fin.milkIncome).toLocaleString();
            document.getElementById('milkDetails').textContent = 
                `${fin.totalGoats} goats √ó ${state.targetMilk} L/day √ó ${state.milkPrice} Kshs/L √ó 30 days = Primary revenue`;
            
            document.getElementById('breedingIncome').textContent = 'Kshs. ' + Math.round(fin.breedingIncome).toLocaleString();
            document.getElementById('breedingDetails').textContent = 
                `${state.numBucks} buck √ó ${EXTERNAL_FARMERS_PER_BUCK} external farmers √ó ${state.breedingFee} Kshs/service`;
            
            document.getElementById('manureIncome').textContent = 'Kshs. ' + Math.round(fin.manureIncome).toLocaleString();
            document.getElementById('manureDetails').textContent = 
                `${state.groupMembers} farmers √ó ${MANURE_PER_DAY} Kshs/day √ó 30 days`;
            
            document.getElementById('kidIncome').textContent = 'Kshs. ' + Math.round(fin.kidIncome).toLocaleString();
            document.getElementById('kidDetails').textContent = 
                `${fin.totalGoats} goats √ó ${(BREEDING_RATE * 100).toFixed(0)}% rate √ó ${KID_PRICE.toLocaleString()} Kshs √∑ 3 months`;
            
            document.getElementById('totalMonthlyIncome').textContent = Math.round(fin.totalMonthlyIncome).toLocaleString();
            
            // Update group metrics
            document.getElementById('displayGroupMembers').textContent = state.groupMembers;
            document.getElementById('totalGoats').textContent = fin.totalGoats;
            document.getElementById('displayNumBucks').textContent = state.numBucks;
            document.getElementById('displayTargetMilk').textContent = state.targetMilk.toFixed(1) + 'L';
            
            // Update stakeholder cards
            // Financier
            document.getElementById('financierInvestment').textContent = state.totalFloat.toLocaleString();
            document.getElementById('financierRepayment').textContent = Math.round(fin.totalRepayable).toLocaleString();
            document.getElementById('financierProfit').textContent = Math.round(fin.financierProfit).toLocaleString();
            document.getElementById('financierROI').textContent = 'ROI: ' + fin.financierROI.toFixed(0) + '%';
            document.getElementById('financierMonthly').textContent = Math.round(fin.monthlyRepayment).toLocaleString();
            document.getElementById('financierRate').textContent = state.interestRate.toFixed(1) + '%/month';
            
            // Imfuyo
            document.getElementById('imfuyoFeePercent').textContent = state.imfuyoFee;
            document.getElementById('imfuyoEarnings').textContent = Math.round(fin.imfuyoTotalEarnings).toLocaleString();
            document.getElementById('imfuyoMonthly').textContent = Math.round(fin.imfuyoMonthlyEarnings).toLocaleString();
            document.getElementById('imfuyoROI').textContent = 'Fee: ' + state.imfuyoFee + '%';
            
            // Farmers
            document.getElementById('farmerMonthlyIncome').textContent = Math.round(fin.farmerMonthlyIncome).toLocaleString();
            document.getElementById('farmerMonthlyPayment').textContent = Math.round(fin.perFarmerPayment).toLocaleString();
            document.getElementById('farmerNetIncome').textContent = Math.round(fin.farmerNetIncome).toLocaleString();
            document.getElementById('totalFarmersNet').textContent = Math.round(fin.farmerNetIncome * state.groupMembers).toLocaleString();
            document.getElementById('paymentBurden').textContent = fin.paymentBurdenPercent.toFixed(0) + '%';
            document.getElementById('keepPercentage').textContent = (100 - fin.paymentBurdenPercent).toFixed(0) + '%';
            
            // Update summary in highlight box
            document.getElementById('summaryFinancierROI').textContent = fin.financierROI.toFixed(0) + '%';
            document.getElementById('summaryImfuyoTotal').textContent = Math.round(fin.imfuyoTotalEarnings).toLocaleString();
            document.getElementById('summaryFarmerNet').textContent = Math.round(fin.farmerNetIncome).toLocaleString();
            document.getElementById('summaryFarmerPayment').textContent = Math.round(fin.perFarmerPayment).toLocaleString();
            document.getElementById('totalValueCreated').textContent = Math.round(fin.total12MonthIncome).toLocaleString();
            
            // Update 12-month projections
            document.getElementById('total12MonthIncome').textContent = Math.round(fin.total12MonthIncome).toLocaleString();
            document.getElementById('total12MonthRepay').textContent = Math.round(fin.total12MonthRepay).toLocaleString();
            document.getElementById('total12MonthProfit').textContent = Math.round(fin.total12MonthProfit).toLocaleString();
            document.getElementById('avgMonthlySurplus').textContent = Math.round(fin.avgMonthlySurplus).toLocaleString();
            
            // Update comparison table
            document.getElementById('compPayment').textContent = Math.round(fin.perFarmerPayment).toLocaleString();
            const paymentReduction = ((6111 - fin.perFarmerPayment) / 6111 * 100).toFixed(0);
            document.getElementById('compPaymentDiff').textContent = paymentReduction;
            
            document.getElementById('compFinancierROI').textContent = fin.financierROI.toFixed(0) + '%';
            const roiDiff = (fin.financierROI - 27.5).toFixed(0);
            document.getElementById('compFinancierDiff').textContent = roiDiff;
            
            document.getElementById('compFarmerNet').textContent = Math.round(fin.farmerNetIncome).toLocaleString();
            const farmerIncrease = ((fin.farmerNetIncome - 4000) / 4000 * 100).toFixed(0);
            document.getElementById('compFarmerDiff').textContent = farmerIncrease;
            
            // Update beyond month 12 section
            document.getElementById('month12ROI').textContent = fin.financierROI.toFixed(0) + '%';
            document.getElementById('summaryYear1Profit').textContent = Math.round(fin.financierProfit).toLocaleString();
            
            // Update charts
            updateCharts(fin);
        }
        
        function updateCharts(fin) {
            // Update milk growth chart
            const milkProgression = [0.5, 0.7, 1.0, 1.2, 1.4, state.targetMilk, state.targetMilk];
            milkGrowthChart.data.datasets[0].data = milkProgression;
            milkGrowthChart.update();
            
            // Update projection chart
            const incomeData = [];
            const paymentData = [];
            const netData = [];
            
            for (let i = 0; i < 12; i++) {
                // Income ramps up over first 3 months
                let monthlyIncome;
                if (i === 0) monthlyIncome = fin.totalMonthlyIncome * 0.6;
                else if (i === 1) monthlyIncome = fin.totalMonthlyIncome * 0.8;
                else monthlyIncome = fin.totalMonthlyIncome;
                
                incomeData.push(Math.round(monthlyIncome));
                paymentData.push(Math.round(fin.totalMonthlyPayment));
                netData.push(Math.round(monthlyIncome - fin.totalMonthlyPayment));
            }
            
            projectionChart.data.datasets[0].data = incomeData;
            projectionChart.data.datasets[1].data = paymentData;
            projectionChart.data.datasets[2].data = netData;
            projectionChart.update();
        }
    </script>
</body>
</html>
