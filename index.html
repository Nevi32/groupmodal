<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Loan Model Simulator - Community Asset Model</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --cream: #FFF8E7;
            --cream-dark: #F5E6C8;
            --black: #0A0A0A;
            --slate: #475569;
            --slate-light: #64748B;
            --slate-dark: #334155;
            --accent-green: #10B981;
            --accent-yellow: #F59E0B;
            --accent-red: #EF4444;
            --accent-blue: #3B82F6;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%);
            color: var(--black);
            line-height: 1.6;
            min-height: 100vh;
            padding: 1.5rem;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 1.5rem;
            animation: slideDown 0.6s ease-out;
        }
        
        h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.25rem;
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            font-size: 0.95rem;
            color: var(--slate);
            font-weight: 400;
        }
        
        .model-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .comparison-badge {
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .individual-model {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            border: 2px solid var(--accent-red);
        }
        
        .group-model {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border: 2px solid var(--accent-green);
        }
        
        .badge-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .badge-stats {
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05), 0 6px 12px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.6s ease-out;
            animation-fill-mode: both;
            border: 1px solid rgba(71, 85, 105, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .panel:nth-child(1) { animation-delay: 0.1s; }
        .panel:nth-child(2) { animation-delay: 0.2s; }
        .panel:nth-child(3) { animation-delay: 0.3s; }
        .panel:nth-child(4) { animation-delay: 0.4s; }
        .panel:nth-child(5) { animation-delay: 0.5s; }
        .panel:nth-child(6) { animation-delay: 0.6s; }
        
        .panel-header {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--black);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .panel-icon {
            font-size: 1.4rem;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .two-thirds {
            grid-column: span 2;
        }
        
        .control-group {
            margin-bottom: 1rem;
        }
        
        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--slate-dark);
            font-size: 0.85rem;
        }
        
        .control-value {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            color: var(--black);
            font-size: 0.95rem;
        }
        
        .slider {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--cream-dark);
            border-radius: 8px;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            background: white;
            color: var(--black);
            transition: all 0.3s ease;
        }
        
        .slider:focus {
            outline: none;
            border-color: var(--black);
            box-shadow: 0 0 0 3px rgba(10, 10, 10, 0.1);
        }
        
        .slider:hover {
            border-color: var(--slate);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .metric-card {
            background: var(--cream);
            padding: 0.875rem;
            border-radius: 8px;
            border-left: 3px solid var(--black);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .metric-label {
            font-size: 0.75rem;
            color: var(--slate);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .metric-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--black);
        }
        
        .metric-subtext {
            font-size: 0.7rem;
            color: var(--slate-light);
            margin-top: 0.25rem;
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 1rem;
        }
        
        .income-stream {
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--accent-green);
            transition: all 0.3s ease;
        }
        
        .income-stream:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .income-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        
        .income-name {
            font-weight: 600;
            color: var(--black);
            font-size: 0.9rem;
        }
        
        .income-amount {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: var(--accent-green);
            font-size: 1rem;
        }
        
        .income-details {
            font-size: 0.75rem;
            color: var(--slate);
            line-height: 1.4;
        }
        
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin-top: 1rem;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--cream-dark);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .timeline-dot {
            position: absolute;
            left: -1.5rem;
            top: 0.25rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-green);
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--accent-green);
        }
        
        .timeline-month {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: var(--black);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .timeline-event {
            font-size: 0.8rem;
            color: var(--slate-dark);
            line-height: 1.4;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--cream-dark);
            font-size: 0.85rem;
        }
        
        .comparison-table th {
            background: var(--cream);
            font-weight: 600;
            color: var(--black);
        }
        
        .comparison-table .better {
            color: var(--accent-green);
            font-weight: 600;
        }
        
        .comparison-table .worse {
            color: var(--accent-red);
            font-weight: 600;
        }
        
        .help-text {
            background: var(--slate-dark);
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            border-left: 4px solid #4F46E5;
        }
        
        .highlight-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: #312E81;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .highlight-text {
            font-size: 0.85rem;
            color: #4C1D95;
            line-height: 1.5;
        }
        
        .risk-indicator {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .risk-low {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .risk-medium {
            background: #FEF3C7;
            color: #92400E;
        }
        
        .risk-high {
            background: #FEE2E2;
            color: #991B1B;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 1400px) {
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .model-comparison {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üêê Group Loan Model Simulator</h1>
            <p class="subtitle">Community-Based Breeding & Milk Production Model - Shared Assets, Multiple Income Streams</p>
        </header>
        
        <div class="model-comparison">
            <div class="comparison-badge individual-model">
                <div class="badge-title">‚ùå Individual Model</div>
                <div class="badge-stats">
                    Default Risk: <strong>10-15%</strong><br>
                    Monthly Burden: <strong>Kshs. 6,111</strong><br>
                    Income Streams: <strong>1 (Milk Only)</strong><br>
                    Farmer Isolation: <strong>High</strong>
                </div>
            </div>
            <div class="comparison-badge group-model">
                <div class="badge-title">‚úÖ Group Model (This Simulator)</div>
                <div class="badge-stats">
                    Default Risk: <strong>2-5%</strong><br>
                    Monthly Burden: <strong>Kshs. 1,200/person</strong><br>
                    Income Streams: <strong>4 (Milk, Breeding, Manure, Kids)</strong><br>
                    Community Support: <strong>High</strong>
                </div>
            </div>
        </div>
        
        <div class="dashboard">
            <!-- Panel 1: Float Allocation -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">üí∞</span>
                    Float Allocation
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Total Float (Kshs.)</span>
                        <span class="control-value">Kshs. <span id="totalFloatValue">300,000</span></span>
                    </div>
                    <input type="number" min="200000" max="500000" step="10000" value="300000" class="slider" id="totalFloat" placeholder="Enter amount">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Breeding Bucks Allocation (%)</span>
                        <span class="control-value"><span id="bucksAllocationValue">50</span>%</span>
                    </div>
                    <input type="number" min="30" max="70" step="5" value="50" class="slider" id="bucksAllocation" placeholder="Enter percentage">
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">For Breeding Bucks</div>
                        <div class="metric-value" id="bucksAmount">150,000</div>
                        <div class="metric-subtext">Community asset</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">For Operations</div>
                        <div class="metric-value" id="operationsAmount">150,000</div>
                        <div class="metric-subtext">Feed, training, infrastructure</div>
                    </div>
                </div>
                
                <div class="help-text">
                    <strong>üí° Float Strategy:</strong> Breeding bucks become group assets that generate income through breeding services. Operations budget covers feed (improves milk), training, collection center, and chilling equipment.
                </div>
            </div>
            
            <!-- Panel 2: Group Setup -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">üë•</span>
                    Group Configuration
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Group Members</span>
                        <span class="control-value"><span id="groupMembersValue">20</span> farmers</span>
                    </div>
                    <input type="number" min="10" max="50" step="1" value="20" class="slider" id="groupMembers" placeholder="Number of farmers">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Avg Goats per Farmer</span>
                        <span class="control-value"><span id="goatsPerFarmerValue">3</span> goats</span>
                    </div>
                    <input type="number" min="2" max="6" step="1" value="3" class="slider" id="goatsPerFarmer" placeholder="Goats per farmer">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Number of Breeding Bucks</span>
                        <span class="control-value"><span id="numBucksValue">1</span> buck(s)</span>
                    </div>
                    <input type="number" min="1" max="2" step="1" value="1" class="slider" id="numBucks" placeholder="Number of bucks">
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Total Group Goats</div>
                        <div class="metric-value" id="totalGoats">60</div>
                        <div class="metric-subtext">Productive does</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Buck Cost Each</div>
                        <div class="metric-value">100,000</div>
                        <div class="metric-subtext">High-quality breeding buck</div>
                    </div>
                </div>
                
                <div class="metrics-grid" style="margin-top: 1rem;">
                    <div class="metric-card">
                        <div class="metric-label">Total Buck Investment</div>
                        <div class="metric-value" id="totalBuckCost">100,000</div>
                        <div class="metric-subtext">Group breeding assets</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Remaining for Operations</div>
                        <div class="metric-value" id="remainingFloat">200,000</div>
                        <div class="metric-subtext">Feed, training, infrastructure</div>
                    </div>
                </div>
            </div>
            
            <!-- Panel 3: Operations Budget Breakdown -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">üì¶</span>
                    Operations Float Allocation
                </div>
                
                <div class="income-stream" style="border-left-color: var(--accent-blue);">
                    <div class="income-header">
                        <span class="income-name">üåæ Feed & Concentrate</span>
                        <span class="income-amount" id="feedBudget">Kshs. 80,000</span>
                    </div>
                    <div class="income-details">
                        <span id="feedDetails">Improved feed to boost milk from 0.5L to 1.5L per goat</span>
                    </div>
                </div>
                
                <div class="income-stream" style="border-left-color: var(--accent-blue);">
                    <div class="income-header">
                        <span class="income-name">üéì Training Programs</span>
                        <span class="income-amount" id="trainingBudget">Kshs. 30,000</span>
                    </div>
                    <div class="income-details">
                        <span>Billys milk quality training + Imfuyo farming best practices</span>
                    </div>
                </div>
                
                <div class="income-stream" style="border-left-color: var(--accent-blue);">
                    <div class="income-header">
                        <span class="income-name">üèóÔ∏è Collection Center</span>
                        <span class="income-amount" id="centerBudget">Kshs. 50,000</span>
                    </div>
                    <div class="income-details">
                        <span>Chilling equipment, collection buckets, milk testing kits</span>
                    </div>
                </div>
                
                <div class="income-stream" style="border-left-color: var(--accent-blue);">
                    <div class="income-header">
                        <span class="income-name">üíâ Veterinary & Tags</span>
                        <span class="income-amount" id="vetBudget">Kshs. 20,000</span>
                    </div>
                    <div class="income-details">
                        <span>Imfuyo services: vaccinations, tagging, health monitoring</span>
                    </div>
                </div>
                
                <div class="income-stream" style="border-left-color: var(--accent-blue);">
                    <div class="income-header">
                        <span class="income-name">üè† Shelter Improvements</span>
                        <span class="income-amount" id="shelterBudget">Kshs. 20,000</span>
                    </div>
                    <div class="income-details">
                        <span>Group shelter materials, fencing, water systems</span>
                    </div>
                </div>
                
                <div class="metrics-grid" style="margin-top: 1rem;">
                    <div class="metric-card" style="grid-column: 1 / -1; border-left-color: var(--accent-blue);">
                        <div class="metric-label">Total Operations Budget</div>
                        <div class="metric-value" id="totalOperations">200,000</div>
                        <div class="metric-subtext">Complete infrastructure & support</div>
                    </div>
                </div>
                
                <div class="help-text">
                    <strong>üí° Smart Allocation:</strong> With only 100-200K on bucks (1-2 high-quality), the remaining 100-200K builds complete support infrastructure. This ensures farmers have everything needed to maximize productivity and income.
                </div>
            </div>
            
            <!-- Panel 3.5: Individual Farmer Breakdown -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">üë§</span>
                    Individual Farmer Income
                </div>
                
                <div class="help-text" style="background: #D1FAE5; color: #065F46; margin-top: 0; margin-bottom: 1rem;">
                    <strong>üíö Why Defaults Are Minimal:</strong> Each farmer earns far more than they pay. Group support ensures accountability.
                </div>
                
                <div class="metric-card" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); margin-bottom: 1rem;">
                    <div class="metric-label" style="color: #78350F;">Monthly Payment per Farmer</div>
                    <div class="metric-value" style="font-size: 2rem; color: #78350F;" id="individualPayment">1,200</div>
                    <div class="metric-subtext" style="color: #92400E;">Their share of group loan</div>
                </div>
                
                <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--slate-dark);">Personal Monthly Income:</div>
                
                <div style="background: var(--cream); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 3px solid var(--accent-green);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                        <span style="font-size: 0.85rem; color: var(--slate-dark);">ü•õ Personal Milk Sales</span>
                        <strong style="color: var(--accent-green); font-family: 'Space Grotesk'; font-size: 0.95rem;" id="indivMilkIncome">6,300</strong>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--slate); line-height: 1.3;">
                        <span id="indivMilkCalc">3 goats √ó 1.5L/day √ó 70 Kshs √ó 30 days</span>
                    </div>
                </div>
                
                <div style="background: var(--cream); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 3px solid var(--accent-green);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                        <span style="font-size: 0.85rem; color: var(--slate-dark);">üêê Breeding Income Share</span>
                        <strong style="color: var(--accent-green); font-family: 'Space Grotesk'; font-size: 0.95rem;" id="indivBreedingIncome">400</strong>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--slate); line-height: 1.3;">
                        Equal share of group breeding revenue
                    </div>
                </div>
                
                <div style="background: var(--cream); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 3px solid var(--accent-green);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                        <span style="font-size: 0.85rem; color: var(--slate-dark);">üå± Personal Manure Sales</span>
                        <strong style="color: var(--accent-green); font-family: 'Space Grotesk'; font-size: 0.95rem;">300</strong>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--slate); line-height: 1.3;">
                        10 Kshs/day √ó 30 days = organic fertilizer
                    </div>
                </div>
                
                <div style="background: var(--cream); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; border-left: 3px solid var(--accent-green);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                        <span style="font-size: 0.85rem; color: var(--slate-dark);">üë∂ Kid Sales Share</span>
                        <strong style="color: var(--accent-green); font-family: 'Space Grotesk'; font-size: 0.95rem;" id="indivKidIncome">800</strong>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--slate); line-height: 1.3;">
                        Their goats' kids + group share
                    </div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card" style="border-color: var(--accent-green);">
                        <div class="metric-label">Total Monthly Income</div>
                        <div class="metric-value" style="color: var(--accent-green);" id="individualTotalIncome">7,800</div>
                        <div class="metric-subtext">Before loan payment</div>
                    </div>
                    <div class="metric-card" style="border-color: var(--accent-blue);">
                        <div class="metric-label">Net Take-Home</div>
                        <div class="metric-value" style="color: var(--accent-blue);" id="individualNetIncome">6,600</div>
                        <div class="metric-subtext">After paying Kshs. <span id="paymentInNet">1,200</span></div>
                    </div>
                </div>
                
                <div class="highlight-box" style="margin-top: 1rem;">
                    <div class="highlight-title">üìä Why This Prevents Defaults:</div>
                    <div class="highlight-text">
                        Payment is only <strong id="paymentBurden" style="font-size: 1.1rem; color: #4F46E5;">15%</strong> of income. Farmer keeps <strong id="keepPercentage" style="font-size: 1.1rem; color: #10B981;">85%</strong> (Kshs. <span id="keepAmount">6,600</span>). This is <strong style="color: #10B981;">extremely sustainable</strong> ‚Äî industry safe zone is under 30%. Plus group peer pressure adds social collateral!
                    </div>
                </div>
            </div>
            
            <!-- Panel 4: Milk Production Evolution -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">ü•õ</span>
                    Milk Production Evolution
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Current Milk (L/goat/day)</span>
                        <span class="control-value"><span id="currentMilkValue">0.5</span> L</span>
                    </div>
                    <input type="number" min="0.3" max="1" step="0.1" value="0.5" class="slider" id="currentMilk" placeholder="Liters per goat">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Target Milk (L/goat/day)</span>
                        <span class="control-value"><span id="targetMilkValue">1.5</span> L</span>
                    </div>
                    <input type="number" min="1" max="3" step="0.1" value="1.5" class="slider" id="targetMilk" placeholder="Target liters">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Months to Target</span>
                        <span class="control-value"><span id="monthsToTargetValue">2</span> months</span>
                    </div>
                    <input type="number" min="1" max="6" step="1" value="2" class="slider" id="monthsToTarget" placeholder="Months">
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Current Daily (Group)</div>
                        <div class="metric-value" id="currentDailyMilk">30</div>
                        <div class="metric-subtext">Liters/day</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Target Daily (Group)</div>
                        <div class="metric-value" id="targetDailyMilk">90</div>
                        <div class="metric-subtext">Liters/day (3x growth!)</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="milkGrowthChart"></canvas>
                </div>
            </div>
            
            <!-- Panel 5: Income Streams -->
            <div class="panel two-thirds">
                <div class="panel-header">
                    <span class="panel-icon">üíµ</span>
                    Multiple Income Streams (Monthly)
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">ü•õ Milk Sales (Billys Offtaker)</span>
                        <span class="income-amount" id="milkIncome">Kshs. 126,000</span>
                    </div>
                    <div class="income-details">
                        <span id="milkDetails">60 goats √ó 1.5 L/day √ó 70 Kshs/L √ó 30 days = Primary revenue stream</span>
                    </div>
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">üêê Breeding Services (External Farmers)</span>
                        <span class="income-amount" id="breedingIncome">Kshs. 24,000</span>
                    </div>
                    <div class="income-details">
                        <span id="breedingDetails">3 bucks √ó 20 external farmers √ó 400 Kshs/service = Buck asset monetization</span>
                    </div>
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">üå± Manure Sales</span>
                        <span class="income-amount" id="manureIncome">Kshs. 6,000</span>
                    </div>
                    <div class="income-details">
                        <span id="manureDetails">20 farmers √ó 10 Kshs/day √ó 30 days = Organic fertilizer revenue</span>
                    </div>
                </div>
                
                <div class="income-stream">
                    <div class="income-header">
                        <span class="income-name">üë∂ Kid Sales (Quarterly)</span>
                        <span class="income-amount" id="kidIncome">Kshs. 16,000</span>
                    </div>
                    <div class="income-details">
                        <span id="kidDetails">60 goats √ó 30% breeding rate √ó 4,000 Kshs/kid √∑ 3 months = Improved genetics</span>
                    </div>
                </div>
                
                <div class="metrics-grid" style="margin-top: 1rem;">
                    <div class="metric-card" style="grid-column: 1 / -1;">
                        <div class="metric-label">Total Monthly Group Income</div>
                        <div class="metric-value" style="font-size: 2rem; color: var(--accent-green);" id="totalMonthlyIncome">172,000</div>
                        <div class="metric-subtext">Diversified revenue = lower risk</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Group Loan Payment</div>
                        <div class="metric-value" id="groupLoanPayment">24,000</div>
                        <div class="metric-subtext">14% of income</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Per Farmer Payment</div>
                        <div class="metric-value" id="perFarmerPayment">1,200</div>
                        <div class="metric-subtext">vs. 6,111 individual</div>
                    </div>
                </div>
                
                <div class="highlight-box">
                    <div class="highlight-title">üéØ Why This Works Better:</div>
                    <div class="highlight-text">
                        Group model spreads risk across 20 farmers and 4 income streams. Each farmer pays <strong>only Kshs. 1,200/month</strong> instead of 6,111. Community support reduces defaults from 10% to <strong>2-5%</strong>. Shared bucks generate breeding income. Better feed = 3x milk production = everyone wins!
                    </div>
                </div>
            </div>
            
            <!-- Panel 6: Timeline -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">üìÖ</span>
                    Growth Timeline
                </div>
                
                <div class="timeline" id="growthTimeline">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            
            <!-- Panel 7: Financial Projection -->
            <div class="panel full-width">
                <div class="panel-header">
                    <span class="panel-icon">üìä</span>
                    12-Month Financial Projection & Comparison
                </div>
                
                <div class="chart-container" style="height: 300px;">
                    <canvas id="projectionChart"></canvas>
                </div>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Individual Model</th>
                            <th>Group Model</th>
                            <th>Difference</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Default Risk</td>
                            <td class="worse">10-15%</td>
                            <td class="better">2-5%</td>
                            <td class="better">‚Üì 67% lower</td>
                        </tr>
                        <tr>
                            <td>Monthly Payment/Person</td>
                            <td class="worse">Kshs. 6,111</td>
                            <td class="better" id="compPerFarmer">Kshs. 1,200</td>
                            <td class="better" id="compReduction">‚Üì 80% lighter</td>
                        </tr>
                        <tr>
                            <td>Income Streams</td>
                            <td class="worse">1 (Milk only)</td>
                            <td class="better">4 (Diversified)</td>
                            <td class="better">+300% more</td>
                        </tr>
                        <tr>
                            <td>Milk Production Growth</td>
                            <td class="worse">0% (no feed support)</td>
                            <td class="better" id="compMilkGrowth">+200%</td>
                            <td class="better">Massive improvement</td>
                        </tr>
                        <tr>
                            <td>Community Support</td>
                            <td class="worse">None (isolated)</td>
                            <td class="better">High (group pressure)</td>
                            <td class="better">Social collateral</td>
                        </tr>
                        <tr>
                            <td>Asset Ownership</td>
                            <td class="worse">Individual debt</td>
                            <td class="better">Shared assets</td>
                            <td class="better">Lower individual risk</td>
                        </tr>
                        <tr>
                            <td>Training & Support</td>
                            <td class="worse">Minimal</td>
                            <td class="better">Comprehensive (Billys + Imfuyo)</td>
                            <td class="better">Continuous improvement</td>
                        </tr>
                        <tr>
                            <td>12-Month ROI (Financier)</td>
                            <td>25-30%</td>
                            <td class="better" id="compROI">35-40%</td>
                            <td class="better" id="compROIDiff">+33% higher</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Panel 8: Risk Analysis -->
            <div class="panel two-thirds">
                <div class="panel-header">
                    <span class="panel-icon">‚öñÔ∏è</span>
                    Risk Analysis & Mitigation
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Overall Risk Level</div>
                        <div class="metric-value">
                            <span class="risk-indicator risk-low">LOW RISK</span>
                        </div>
                        <div class="metric-subtext">Multiple safety mechanisms</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Repayment Rate</div>
                        <div class="metric-value" id="repaymentRate">96%</div>
                        <div class="metric-subtext">Group accountability</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Data Tracking</div>
                        <div class="metric-value">100%</div>
                        <div class="metric-subtext">Imfuyo system monitors all</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Income Stability</div>
                        <div class="metric-value">HIGH</div>
                        <div class="metric-subtext">4 revenue streams</div>
                    </div>
                </div>
                
                <div class="highlight-box" style="margin-top: 1rem;">
                    <div class="highlight-title">üõ°Ô∏è Risk Mitigation Strategies:</div>
                    <div class="highlight-text">
                        <strong>1. Group Accountability:</strong> Peer pressure and community support ensure 96%+ repayment<br>
                        <strong>2. Diversified Income:</strong> 4 streams mean if milk prices drop, breeding/manure/kids compensate<br>
                        <strong>3. Real-Time Monitoring:</strong> Imfuyo tracks milk production, quality, feeding regimen daily<br>
                        <strong>4. Guaranteed Offtaker:</strong> Billys committed to buying all quality milk at 70 Kshs/L<br>
                        <strong>5. Asset Appreciation:</strong> Bucks increase in value as they produce quality offspring<br>
                        <strong>6. Training Program:</strong> Continuous education improves farmer knowledge & productivity
                    </div>
                </div>
            </div>
            
            <!-- Panel 8: Potential Weaknesses -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">‚ö†Ô∏è</span>
                    Potential Challenges
                </div>
                
                <div class="help-text" style="background: #FEF3C7; color: #78350F; margin-top: 0;">
                    <strong>üîç Where It Could Fall Short:</strong>
                </div>
                
                <div style="margin-top: 1rem; font-size: 0.85rem; line-height: 1.6;">
                    <p style="margin-bottom: 0.75rem;"><strong>1. Group Dynamics:</strong> Conflicts between members could slow decisions. <em>Mitigation: Clear governance rules, regular meetings.</em></p>
                    
                    <p style="margin-bottom: 0.75rem;"><strong>2. Collective Responsibility:</strong> If 2-3 farmers underperform, others may need to cover. <em>Mitigation: Individual tracking, peer mentoring.</em></p>
                    
                    <p style="margin-bottom: 0.75rem;"><strong>3. Training Adoption:</strong> Not all farmers may follow feeding/care protocols. <em>Mitigation: Incentives for top performers, data visibility.</em></p>
                    
                    <p style="margin-bottom: 0.75rem;"><strong>4. Buck Management:</strong> Shared assets need careful scheduling and care. <em>Mitigation: Rotation system, dedicated keeper, tracking.</em></p>
                    
                    <p style="margin-bottom: 0.75rem;"><strong>5. Initial Ramp-Up:</strong> Takes 2 months for full productivity gains. <em>Mitigation: Grace period, interim monitoring.</em></p>
                </div>
                
                <div class="highlight-box" style="background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%); border-color: var(--accent-green); margin-top: 1rem;">
                    <div class="highlight-title" style="color: #065F46;">‚úÖ Overall Assessment:</div>
                    <div class="highlight-text" style="color: #065F46;">
                        Despite potential challenges, the group model is <strong>significantly superior</strong>. Lower individual burden, diversified income, community support, and data tracking make this the optimal approach. Benefits far outweigh risks.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global state
        let state = {
            totalFloat: 300000,
            bucksAllocation: 50,
            groupMembers: 20,
            goatsPerFarmer: 3,
            numBucks: 1,
            currentMilk: 0.5,
            targetMilk: 1.5,
            monthsToTarget: 2
        };
        
        // Chart instances
        let milkGrowthChart, projectionChart;
        
        // Constants
        const MILK_PRICE = 70; // Kshs per liter
        const BREEDING_FEE = 400; // Kshs per service
        const MANURE_PER_DAY = 10; // Kshs per farmer per day
        const KID_PRICE = 4000; // Kshs per kid
        const BREEDING_RATE = 0.3; // 30% of goats breed per quarter
        const EXTERNAL_FARMERS_PER_BUCK = 20; // External farmers using breeding services
        const BUCK_PRICE = 100000; // Price per quality buck (FIXED at 100K)
        const IMFUYO_SERVICE_FEE = 5000; // Per farmer for shelter, tagging, vet, etc.
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            attachEventListeners();
            updateAll();
        });
        
        function initializeCharts() {
            // Milk Growth Chart
            const milkCtx = document.getElementById('milkGrowthChart').getContext('2d');
            milkGrowthChart = new Chart(milkCtx, {
                type: 'line',
                data: {
                    labels: ['Month 0', 'Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5', 'Month 6'],
                    datasets: [{
                        label: 'Liters/Goat/Day',
                        data: [0.5, 0.7, 1.0, 1.2, 1.4, 1.5, 1.5],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Milk: ' + context.parsed.y + ' L/goat/day';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 2,
                            ticks: {
                                callback: function(value) {
                                    return value + ' L';
                                }
                            }
                        }
                    }
                }
            });
            
            // Projection Chart
            const projCtx = document.getElementById('projectionChart').getContext('2d');
            projectionChart = new Chart(projCtx, {
                type: 'bar',
                data: {
                    labels: ['Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5', 'Month 6', 'Month 7', 'Month 8', 'Month 9', 'Month 10', 'Month 11', 'Month 12'],
                    datasets: [
                        {
                            label: 'Group Income',
                            data: [80000, 95000, 115000, 135000, 155000, 172000, 172000, 172000, 172000, 172000, 172000, 172000],
                            backgroundColor: '#10B981',
                            borderRadius: 6
                        },
                        {
                            label: 'Group Expenses',
                            data: [24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000],
                            backgroundColor: '#F59E0B',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: false },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Kshs. ' + (value / 1000) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: 'DM Sans', size: 11 },
                                padding: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': Kshs. ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function attachEventListeners() {
            document.getElementById('totalFloat').addEventListener('input', (e) => {
                state.totalFloat = parseInt(e.target.value);
                updateAll();
            });
            
            document.getElementById('bucksAllocation').addEventListener('input', (e) => {
                state.bucksAllocation = parseInt(e.target.value);
                updateAll();
            });
            
            document.getElementById('groupMembers').addEventListener('input', (e) => {
                state.groupMembers = parseInt(e.target.value);
                updateAll();
            });
            
            document.getElementById('goatsPerFarmer').addEventListener('input', (e) => {
                state.goatsPerFarmer = parseInt(e.target.value);
                updateAll();
            });
            
            document.getElementById('numBucks').addEventListener('input', (e) => {
                state.numBucks = parseInt(e.target.value);
                updateAll();
            });
            
            document.getElementById('currentMilk').addEventListener('input', (e) => {
                state.currentMilk = parseFloat(e.target.value);
                updateAll();
            });
            
            document.getElementById('targetMilk').addEventListener('input', (e) => {
                state.targetMilk = parseFloat(e.target.value);
                updateAll();
            });
            
            document.getElementById('monthsToTarget').addEventListener('input', (e) => {
                state.monthsToTarget = parseInt(e.target.value);
                updateAll();
            });
        }
        
        function calculateFinancials() {
            const bucksAmount = state.totalFloat * (state.bucksAllocation / 100);
            const operationsAmount = state.totalFloat - bucksAmount;
            const totalGoats = state.groupMembers * state.goatsPerFarmer;
            const buckCost = BUCK_PRICE;
            
            // Current vs Target daily milk
            const currentDailyMilk = totalGoats * state.currentMilk;
            const targetDailyMilk = totalGoats * state.targetMilk;
            
            // Income streams (at target)
            const milkIncome = targetDailyMilk * MILK_PRICE * 30;
            const breedingIncome = state.numBucks * EXTERNAL_FARMERS_PER_BUCK * BREEDING_FEE;
            const manureIncome = state.groupMembers * MANURE_PER_DAY * 30;
            const kidIncome = (totalGoats * BREEDING_RATE * KID_PRICE) / 3; // Quarterly, so divide by 3
            
            const totalMonthlyIncome = milkIncome + breedingIncome + manureIncome + kidIncome;
            
            // Loan calculation
            const loanAmount = state.totalFloat;
            const interestRate = 0.03; // 3% monthly for group (vs 4.5% individual)
            const tenure = 12;
            const monthlyInterest = loanAmount * interestRate;
            const totalInterest = monthlyInterest * tenure;
            const totalRepayable = loanAmount + totalInterest;
            const groupLoanPayment = totalRepayable / tenure;
            const perFarmerPayment = groupLoanPayment / state.groupMembers;
            
            // Milk growth progression
            const milkGrowth = generateMilkGrowth();
            
            // Individual farmer breakdown
            const indivMilkIncome = state.goatsPerFarmer * state.targetMilk * MILK_PRICE * 30;
            const indivBreedingShare = breedingIncome / state.groupMembers;
            const indivManureIncome = MANURE_PER_DAY * 30;
            const indivKidShare = kidIncome / state.groupMembers;
            const indivTotalIncome = indivMilkIncome + indivBreedingShare + indivManureIncome + indivKidShare;
            const indivNetIncome = indivTotalIncome - perFarmerPayment;
            const paymentBurdenPercent = (perFarmerPayment / indivTotalIncome) * 100;
            
            // Operations budget breakdown
            const totalBuckCost = state.numBucks * BUCK_PRICE;
            const remainingFloat = state.totalFloat - totalBuckCost;
            const feedBudget = remainingFloat * 0.40; // 40% for feed
            const collectionCenter = remainingFloat * 0.25; // 25% for infrastructure
            const trainingBudget = remainingFloat * 0.15; // 15% for training
            const vetBudget = remainingFloat * 0.10; // 10% for vet/Imfuyo services
            const shelterBudget = remainingFloat * 0.10; // 10% for shelter improvements
            
            return {
                bucksAmount,
                operationsAmount,
                totalGoats,
                buckCost,
                currentDailyMilk,
                targetDailyMilk,
                milkIncome,
                breedingIncome,
                manureIncome,
                kidIncome,
                totalMonthlyIncome,
                groupLoanPayment,
                perFarmerPayment,
                milkGrowth,
                repaymentRate: 96 - (state.groupMembers > 30 ? 1 : 0), // Slight decrease with larger groups
                indivMilkIncome,
                indivBreedingShare,
                indivManureIncome,
                indivKidShare,
                indivTotalIncome,
                indivNetIncome,
                paymentBurdenPercent,
                totalBuckCost,
                remainingFloat,
                feedBudget,
                collectionCenter,
                trainingBudget,
                vetBudget,
                shelterBudget
            };
        }
        
        function generateMilkGrowth() {
            const months = [];
            const increment = (state.targetMilk - state.currentMilk) / state.monthsToTarget;
            
            for (let i = 0; i <= 6; i++) {
                if (i <= state.monthsToTarget) {
                    months.push(parseFloat((state.currentMilk + (increment * i)).toFixed(2)));
                } else {
                    months.push(state.targetMilk);
                }
            }
            
            return months;
        }
        
        function updateAll() {
            const fin = calculateFinancials();
            
            // Update slider displays
            document.getElementById('totalFloatValue').textContent = state.totalFloat.toLocaleString();
            document.getElementById('bucksAllocationValue').textContent = state.bucksAllocation;
            document.getElementById('groupMembersValue').textContent = state.groupMembers;
            document.getElementById('goatsPerFarmerValue').textContent = state.goatsPerFarmer;
            document.getElementById('numBucksValue').textContent = state.numBucks;
            document.getElementById('currentMilkValue').textContent = state.currentMilk.toFixed(1);
            document.getElementById('targetMilkValue').textContent = state.targetMilk.toFixed(1);
            document.getElementById('monthsToTargetValue').textContent = state.monthsToTarget;
            
            // Update float allocation
            document.getElementById('bucksAmount').textContent = Math.round(fin.bucksAmount).toLocaleString();
            document.getElementById('operationsAmount').textContent = Math.round(fin.operationsAmount).toLocaleString();
            
            // Update group setup
            document.getElementById('totalGoats').textContent = fin.totalGoats;
            document.getElementById('totalBuckCost').textContent = Math.round(fin.totalBuckCost).toLocaleString();
            document.getElementById('remainingFloat').textContent = Math.round(fin.remainingFloat).toLocaleString();
            
            // Update operations budget breakdown
            document.getElementById('feedBudget').textContent = 'Kshs. ' + Math.round(fin.feedBudget).toLocaleString();
            document.getElementById('collectionCenter').textContent = 'Kshs. ' + Math.round(fin.collectionCenter).toLocaleString();
            document.getElementById('trainingBudget').textContent = 'Kshs. ' + Math.round(fin.trainingBudget).toLocaleString();
            document.getElementById('vetBudget').textContent = 'Kshs. ' + Math.round(fin.vetBudget).toLocaleString();
            document.getElementById('shelterBudget').textContent = 'Kshs. ' + Math.round(fin.shelterBudget).toLocaleString();
            document.getElementById('totalOperations').textContent = Math.round(fin.remainingFloat).toLocaleString();
            
            // Update milk production
            document.getElementById('currentDailyMilk').textContent = fin.currentDailyMilk.toFixed(0);
            document.getElementById('targetDailyMilk').textContent = fin.targetDailyMilk.toFixed(0);
            
            // Update income streams
            document.getElementById('milkIncome').textContent = 'Kshs. ' + Math.round(fin.milkIncome).toLocaleString();
            document.getElementById('milkDetails').textContent = `${fin.totalGoats} goats √ó ${state.targetMilk} L/day √ó ${MILK_PRICE} Kshs/L √ó 30 days = Primary revenue stream`;
            
            document.getElementById('breedingIncome').textContent = 'Kshs. ' + Math.round(fin.breedingIncome).toLocaleString();
            document.getElementById('breedingDetails').textContent = `${state.numBucks} bucks √ó ${EXTERNAL_FARMERS_PER_BUCK} external farmers √ó ${BREEDING_FEE} Kshs/service = Buck asset monetization`;
            
            document.getElementById('manureIncome').textContent = 'Kshs. ' + Math.round(fin.manureIncome).toLocaleString();
            document.getElementById('manureDetails').textContent = `${state.groupMembers} farmers √ó ${MANURE_PER_DAY} Kshs/day √ó 30 days = Organic fertilizer revenue`;
            
            document.getElementById('kidIncome').textContent = 'Kshs. ' + Math.round(fin.kidIncome).toLocaleString();
            document.getElementById('kidDetails').textContent = `${fin.totalGoats} goats √ó ${(BREEDING_RATE * 100).toFixed(0)}% breeding rate √ó ${KID_PRICE.toLocaleString()} Kshs/kid √∑ 3 months = Improved genetics`;
            
            document.getElementById('totalMonthlyIncome').textContent = Math.round(fin.totalMonthlyIncome).toLocaleString();
            document.getElementById('groupLoanPayment').textContent = Math.round(fin.groupLoanPayment).toLocaleString();
            document.getElementById('perFarmerPayment').textContent = Math.round(fin.perFarmerPayment).toLocaleString();
            
            // Update risk analysis
            document.getElementById('repaymentRate').textContent = fin.repaymentRate + '%';
            
            // Update individual farmer breakdown
            document.getElementById('individualPayment').textContent = Math.round(fin.perFarmerPayment).toLocaleString();
            document.getElementById('indivMilkIncome').textContent = Math.round(fin.indivMilkIncome).toLocaleString();
            document.getElementById('indivMilkCalc').textContent = `${state.goatsPerFarmer} goats √ó ${state.targetMilk}L/day √ó ${MILK_PRICE} Kshs √ó 30 days`;
            document.getElementById('indivBreedingIncome').textContent = Math.round(fin.indivBreedingShare).toLocaleString();
            document.getElementById('indivKidIncome').textContent = Math.round(fin.indivKidShare).toLocaleString();
            document.getElementById('individualTotalIncome').textContent = Math.round(fin.indivTotalIncome).toLocaleString();
            document.getElementById('individualNetIncome').textContent = Math.round(fin.indivNetIncome).toLocaleString();
            document.getElementById('paymentInNet').textContent = Math.round(fin.perFarmerPayment).toLocaleString();
            document.getElementById('paymentBurden').textContent = fin.paymentBurdenPercent.toFixed(0) + '%';
            document.getElementById('keepPercentage').textContent = (100 - fin.paymentBurdenPercent).toFixed(0) + '%';
            document.getElementById('keepAmount').textContent = Math.round(fin.indivNetIncome).toLocaleString();
            
            // Update comparison table
            document.getElementById('compPerFarmer').textContent = 'Kshs. ' + Math.round(fin.perFarmerPayment).toLocaleString();
            const reduction = ((6111 - fin.perFarmerPayment) / 6111 * 100).toFixed(0);
            document.getElementById('compReduction').textContent = '‚Üì ' + reduction + '% lighter';
            
            const milkGrowthPercent = ((state.targetMilk - state.currentMilk) / state.currentMilk * 100).toFixed(0);
            document.getElementById('compMilkGrowth').textContent = '+' + milkGrowthPercent + '%';
            
            // Calculate ROI
            const totalRevenue = fin.totalMonthlyIncome * 12;
            const totalCosts = fin.groupLoanPayment * 12;
            const netProfit = totalRevenue - totalCosts;
            const roi = (netProfit / state.totalFloat * 100).toFixed(0);
            document.getElementById('compROI').textContent = roi + '%';
            document.getElementById('compROIDiff').textContent = '+' + (roi - 27).toFixed(0) + '% higher';
            
            // Update charts
            updateCharts(fin);
            
            // Update timeline
            updateTimeline(fin);
        }
        
        function updateCharts(fin) {
            // Update milk growth chart
            milkGrowthChart.data.datasets[0].data = fin.milkGrowth;
            milkGrowthChart.update();
            
            // Update projection chart
            const incomeProgression = [];
            const currentDaily = fin.totalGoats * state.currentMilk;
            
            for (let month = 0; month < 12; month++) {
                let milkForMonth;
                if (month < fin.milkGrowth.length) {
                    milkForMonth = fin.totalGoats * fin.milkGrowth[month] * MILK_PRICE * 30;
                } else {
                    milkForMonth = fin.milkIncome;
                }
                
                const monthlyTotal = milkForMonth + fin.breedingIncome + fin.manureIncome + 
                    (month % 3 === 2 ? fin.kidIncome : 0); // Kids sold quarterly
                
                incomeProgression.push(Math.round(monthlyTotal));
            }
            
            projectionChart.data.datasets[0].data = incomeProgression;
            projectionChart.data.datasets[1].data = Array(12).fill(fin.groupLoanPayment);
            projectionChart.update();
        }
        
        function updateTimeline(fin) {
            const timeline = document.getElementById('growthTimeline');
            
            const events = [
                { month: 'Month 0', event: `Float disbursed: Kshs. ${state.totalFloat.toLocaleString()}. Purchase ${state.numBucks} breeding bucks at Kshs. ${BUCK_PRICE.toLocaleString()} each. Begin farmer training with Billys & Imfuyo.` },
                { month: 'Month 1', event: `Intensive training on feeding regimen, milk quality, goat care. Start improved feed distribution. Milk production begins rising from ${state.currentMilk}L to ${(state.currentMilk + 0.2).toFixed(1)}L per goat.` },
                { month: 'Month 2', event: `Breeding services begin. Milk production reaches ${state.targetMilk}L per goat/day. Collection center operational with chilling equipment. Group income: Kshs. ${Math.round(fin.totalMonthlyIncome * 0.75).toLocaleString()}.` },
                { month: 'Month 3', event: `Full productivity achieved! All 4 income streams active. First kids born from improved breeding. Group earning Kshs. ${Math.round(fin.totalMonthlyIncome).toLocaleString()}/month. Loan payments comfortable at Kshs. ${Math.round(fin.perFarmerPayment).toLocaleString()}/farmer.` },
                { month: 'Month 6', event: `Model fully mature. Consistent milk quality meets Billys standards. ${fin.repaymentRate}% repayment rate. Farmers earning surplus income. External farmers paying for breeding services.` },
                { month: 'Month 12', event: `Loan fully repaid! Group owns bucks outright (asset worth Kshs. ${(state.numBucks * BUCK_PRICE * 1.2).toLocaleString()} with offspring). Can scale to new groups or individual livestock purchases.` }
            ];
            
            timeline.innerHTML = events.map(e => `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-month">${e.month}</div>
                    <div class="timeline-event">${e.event}</div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
